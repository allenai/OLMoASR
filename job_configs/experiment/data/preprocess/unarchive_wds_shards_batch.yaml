version: v2
budget: ai2/oe-data
description: Unarchiving wds shards
tasks:
  - name: unarchive_wds_shards
    image:
      beaker: huongn/unarchive_tar_2
    command: ["/bin/bash", "-c"]
    arguments:
      [
        "python /stage/data_processing/unarchive_tar.py unarchive_tar --source_dir=/weka/huongn/ow_440K_wds/$(printf '%05d' $BEAKER_REPLICA_RANK) --result_path=/data/huongn/data_processing/unarchive_wds_shards_$((BEAKER_REPLICA_RANK + (50 * 48))).txt --batch_size=50 --batch_idx=48",
      ]
    datasets:
      - mountPath: /weka
        source:
          weka: oe-data-default
    result:
      path: /data/huongn/data_processing
    context:
      preemptible: true
    constraints:
      cluster:
        - ai2/jupiter-cirrascale-2
    replicas: 50
