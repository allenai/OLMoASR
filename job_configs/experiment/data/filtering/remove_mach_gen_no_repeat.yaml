version: v2
budget: ai2/oe-data
description: Filtering out data with repeating lines in transcripts
tasks:
  - name: remove_mach_gen_no_repeat
    image:
      beaker: huongn/ow_filter_0
    command: ["/bin/bash", "-c"]
    arguments:
      [
        "python /stage/scripts/data/filtering/data_filter.py 
        --data_dir=/weka/huongn/440K_full 
        --samples_dicts_dir=/weka/huongn/ow_filtering/no_repeat/$(printf '%03d' $BEAKER_REPLICA_RANK)
        --batch_size=245 
        --batch_idx=$BEAKER_REPLICA_RANK
        --filter_mode=True
        --metadata_path=/weka/huongn/ow_filtering/no_repeat/metadata.txt
        no_repeat"
        ]
    datasets:
      - mountPath: /weka
        source:
          weka: oe-data-default
    result:
      path:
    envVars:
      - name: PYTHONPATH
        value: /stage
    resources:
      cpuCount: 20
      gpuCount: 1
      memory: 10GiB
    context:
      priority: normal
      preemptible: true
    constraints:
      cluster:
        - ai2/neptune-cirrascale
    replicas: 10
