version: v2
budget: ai2/prior
description: Eval w/ checkpoint (filtered data)
tasks:
  - name: no_lower_mach_gen_eval
    image:
      beaker: huongn/ow_eval
    command: ["/bin/bash", "-c"]
    arguments: [
        "python /stage/scripts/eval/eval.py
        --ckpt=/weka/huongn/ow_ckpts/no_lower_mach_gen_g9oq1lqk/latest_train_tiny_ddp-train_grad-acc_fp16_non_ddp.pt
        --eval_set=librispeech_other
        --eval_dir=/ow_eval"
      ]
    datasets:
      - mountPath: /weka
        source:
          weka: oe-data-default
      - mountPath: /ow_eval
        source:
          beaker: huongn/mini-job-ow-evalset
    result:
      # Beaker will capture anything that's written to this location and store it in the results
      # dataset. This location is required to be a directory, not a file.
      path: /data/huongn/ow_logs
    envVars:
      - name: PYTHONPATH
        value: /stage
      - name: WANDB_API_KEY
        secret: WANDB_API_KEY
      - name: TORCH_NCCL_BLOCKING_WAIT
        value: 1
      - name: TORCH_NCCL_ASYNC_ERROR_HANDLING
        value:
      - name: NCCL_DEBUG
        value: INFO
    resources:
      cpuCount: 23.25
      gpuCount: 1
    context:
      priority: normal
      preemptible: True
    constraints:
      cluster: [ai2/jupiter-cirrascale-2]
