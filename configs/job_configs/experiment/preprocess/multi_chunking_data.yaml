version: v2
budget: ai2/oe-data
description: chunking audio-transcript pairs
retry:
  allowedTaskRetries: 5
tasks:
- name: chunking_data
  image:
    beaker: huongn/ow_data_processing
  command: ["python", "scripts/data/processing/local/preprocess_flat.py"]
  arguments:
    ["--output_dir=/weka/huongn/ow_seg_long",
     "--source_dir=/weka/huongn/ow_full",
     "--log_dir=/weka/huongn/metadata/ow_seg_long_logs",
     "--job_batch_size=50",
     "--start_shard_idx=13650",
     "--missing_pair_dir=/weka/huongn/ow_seg_long_missing_pairs",
     "--manifest_dir=/weka/huongn/metadata/ow_seg_long_transcript_manifest",
     "--audio_only=True",
     "--transcript_only=False",
     "--in_memory=True"]
  envVars:
  - name: PYTHONPATH
    value: /stage
  datasets:
  - mountPath: /weka
    source:
      weka: oe-data-default
  context:
    priority: high
    preemptible: false
  constraints:
    # cluster: [ai2/saturn-cirrascale]
    hostname: [jupiter-cs-aus-104.reviz.ai2.in]
  replicas: 1
